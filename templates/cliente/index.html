<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Reservas - Cliente</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/cliente.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Agregar Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <!-- Cargar React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- USAR VERBATIM PARA EVITAR QUE DJANGO INTERPRETE EL JS -->
    {% verbatim %}
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        const API_URL = '/api';

        // Componente de logout reutilizable
        function LogoutButton() {
            const handleLogout = () => {
                // Eliminar tokens y datos del usuario
                localStorage.removeItem('access_token');
                localStorage.removeItem('refresh_token');
                localStorage.removeItem('user');
                
                // Opcional: Invalida el token en el servidor si tienes blacklist habilitado
                fetch(`${API_URL}/auth/logout/`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                    }
                }).catch(err => {
                    console.log('Logout del servidor no disponible, continuando...');
                });
                
                // Redirigir a la página de login
                window.location.href = '/login/';
            };

            return (
                <button
                    onClick={handleLogout}
                    className="px-4 py-2 bg-gradient-to-r from-red-600 to-red-800 hover:from-red-700 hover:to-red-900 text-white rounded-lg transition flex items-center gap-2"
                >
                    <i className="fas fa-sign-out-alt"></i>
                    Cerrar Sesión
                </button>
            );
        }

        // Componente principal
        function SistemaReservas() {
            const [activeTab, setActiveTab] = useState('salas');
            const [salas, setSalas] = useState([]);
            const [reservas, setReservas] = useState([]);
            const [usuarios, setUsuarios] = useState([]);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);
            const [success, setSuccess] = useState(null);
            const [modalOpen, setModalOpen] = useState(false);
            const [modalType, setModalType] = useState('');
            const [selectedItem, setSelectedItem] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [filterEstado, setFilterEstado] = useState('todos');

            // Cargar datos al montar
            useEffect(() => {
                cargarDatos();
            }, [activeTab]);

            // Auto-limpiar mensajes después de 5 segundos
            useEffect(() => {
                if (error || success) {
                    const timer = setTimeout(() => {
                        setError(null);
                        setSuccess(null);
                    }, 5000);
                    return () => clearTimeout(timer);
                }
            }, [error, success]);

            const cargarDatos = async () => {
                setLoading(true);
                setError(null);
                try {
                    if (activeTab === 'salas') {
                        await cargarSalas();
                    } else if (activeTab === 'reservas') {
                        await cargarReservas();
                    } else if (activeTab === 'usuarios') {
                        await cargarUsuarios();
                    }
                } catch (err) {
                    setError('Error al cargar datos: ' + err.message);
                } finally {
                    setLoading(false);
                }
            };

            const cargarSalas = async () => {
                const response = await fetch(`${API_URL}/salas/`);
                if (!response.ok) throw new Error('Error al cargar salas');
                const data = await response.json();
                setSalas(data.results || data);
            };

            const cargarReservas = async () => {
                const response = await fetch(`${API_URL}/reservas/`);
                if (!response.ok) throw new Error('Error al cargar reservas');
                const data = await response.json();
                setReservas(data.results || data);
            };

            const cargarUsuarios = async () => {
                const response = await fetch(`${API_URL}/usuarios/`);
                if (!response.ok) throw new Error('Error al cargar usuarios');
                const data = await response.json();
                setUsuarios(data.results || data);
            };

            const abrirModal = (type, item = null) => {
                setModalType(type);
                setSelectedItem(item);
                setModalOpen(true);
            };

            const cerrarModal = () => {
                setModalOpen(false);
                setModalType('');
                setSelectedItem(null);
            };

            const eliminarItem = async (tipo, id) => {
                if (!confirm('¿Estás seguro de que deseas eliminar este elemento?')) return;
                
                try {
                    const response = await fetch(`${API_URL}/${tipo}/${id}/`, {
                        method: 'DELETE',
                    });
                    
                    if (!response.ok) throw new Error('Error al eliminar');
                    
                    setSuccess('Elemento eliminado exitosamente');
                    await cargarDatos();
                } catch (err) {
                    setError('Error al eliminar: ' + err.message);
                }
            };

            const confirmarReserva = async (id) => {
                try {
                    const response = await fetch(`${API_URL}/reservas/${id}/confirmar/`, {
                        method: 'POST',
                    });
                    
                    if (!response.ok) throw new Error('Error al confirmar reserva');
                    
                    setSuccess('Reserva confirmada exitosamente');
                    await cargarReservas();
                } catch (err) {
                    setError('Error al confirmar: ' + err.message);
                }
            };

            const cancelarReserva = async (id) => {
                if (!confirm('¿Deseas cancelar esta reserva?')) return;
                
                try {
                    const response = await fetch(`${API_URL}/reservas/${id}/cancelar/`, {
                        method: 'POST',
                    });
                    
                    if (!response.ok) throw new Error('Error al cancelar reserva');
                    
                    setSuccess('Reserva cancelada exitosamente');
                    await cargarReservas();
                } catch (err) {
                    setError('Error al cancelar: ' + err.message);
                }
            };

            // Filtrar datos
            const datosFiltrados = () => {
                let datos = [];
                if (activeTab === 'salas') datos = salas;
                else if (activeTab === 'reservas') datos = reservas;
                else if (activeTab === 'usuarios') datos = usuarios;

                // Filtrar por búsqueda
                if (searchTerm) {
                    datos = datos.filter(item => {
                        const searchLower = searchTerm.toLowerCase();
                        if (activeTab === 'salas') {
                            return item.nombre?.toLowerCase().includes(searchLower) ||
                                item.ubicacion?.toLowerCase().includes(searchLower);
                        } else if (activeTab === 'reservas') {
                            return item.sala_nombre?.toLowerCase().includes(searchLower) ||
                                item.usuario_nombre?.toLowerCase().includes(searchLower);
                        } else if (activeTab === 'usuarios') {
                            return item.nombre?.toLowerCase().includes(searchLower) ||
                                item.email?.toLowerCase().includes(searchLower) ||
                                item.carrera?.toLowerCase().includes(searchLower);
                        }
                        return false;
                    });
                }

                // Filtrar por estado
                if (filterEstado !== 'todos') {
                    datos = datos.filter(item => item.estado === filterEstado);
                }

                return datos;
            };

            // Componente Sección Salas
            function SeccionSalas({ salas, onEdit, onDelete }) {
                if (salas.length === 0) {
                    return (
                        <div className="text-center py-12 text-slate-400">
                            <i className="fas fa-calendar-alt w-16 h-16 mx-auto mb-4 opacity-50"></i>
                            <p>No hay salas para mostrar</p>
                        </div>
                    );
                }

                return (
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        {salas.map(sala => (
                            <div key={sala.id} className="bg-slate-800 rounded-xl p-6 border border-slate-700 hover:border-blue-500 transition">
                                <div className="flex justify-between items-start mb-4">
                                    <h3 className="text-xl font-bold">{sala.nombre}</h3>
                                    <span className={`px-3 py-1 rounded-full text-xs font-semibold ${
                                        sala.estado === 'disponible' 
                                            ? 'bg-green-500/20 text-green-300 border border-green-500/30' 
                                            : 'bg-red-500/20 text-red-300 border border-red-500/30'
                                    }`}>
                                        {sala.estado}
                                    </span>
                                </div>

                                <div className="space-y-3 mb-4">
                                    <div className="flex items-center gap-2 text-slate-300">
                                        <i className="fas fa-map-marker-alt text-blue-400"></i>
                                        <span className="text-sm">{sala.ubicacion}</span>
                                    </div>
                                    <div className="flex items-center gap-2 text-slate-300">
                                        <i className="fas fa-users text-blue-400"></i>
                                        <span className="text-sm">Capacidad: {sala.capacidad} personas</span>
                                    </div>
                                    <div className="text-sm text-slate-400">
                                        <strong className="text-slate-300">Equipamiento:</strong>
                                        <p className="mt-1">{sala.equipamiento}</p>
                                    </div>
                                </div>

                                <div className="flex gap-2">
                                    <button
                                        onClick={() => onEdit('editarSala', sala)}
                                        className="flex-1 px-3 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition flex items-center justify-center gap-2"
                                    >
                                        <i className="fas fa-edit"></i>
                                        Editar
                                    </button>
                                    <button
                                        onClick={() => onDelete('salas', sala.id)}
                                        className="px-3 py-2 bg-red-600 hover:bg-red-700 rounded-lg transition"
                                    >
                                        <i className="fas fa-trash-alt"></i>
                                    </button>
                                </div>
                            </div>
                        ))}
                    </div>
                );
            }

            // Componente Sección Reservas
            function SeccionReservas({ reservas, onEdit, onDelete, onConfirmar, onCancelar }) {
                if (reservas.length === 0) {
                    return (
                        <div className="text-center py-12 text-slate-400">
                            <i className="fas fa-calendar-alt w-16 h-16 mx-auto mb-4 opacity-50"></i>
                            <p>No hay reservas para mostrar</p>
                        </div>
                    );
                }

                return (
                    <div className="space-y-4">
                        {reservas.map(reserva => (
                            <div key={reserva.id} className="bg-slate-800 rounded-xl p-6 border border-slate-700 hover:border-blue-500 transition">
                                <div className="flex flex-wrap justify-between items-start gap-4 mb-4">
                                    <div>
                                        <h3 className="text-xl font-bold mb-1">{reserva.sala_nombre}</h3>
                                        <p className="text-slate-400">{reserva.usuario_nombre}</p>
                                    </div>
                                    <span className={`px-3 py-1 rounded-full text-xs font-semibold ${
                                        reserva.estado === 'confirmada' 
                                            ? 'bg-green-500/20 text-green-300 border border-green-500/30'
                                            : reserva.estado === 'pendiente'
                                            ? 'bg-yellow-500/20 text-yellow-300 border border-yellow-500/30'
                                            : 'bg-red-500/20 text-red-300 border border-red-500/30'
                                    }`}>
                                        {reserva.estado}
                                    </span>
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                    <div className="flex items-center gap-2 text-slate-300">
                                        <i className="fas fa-calendar text-blue-400"></i>
                                        <span className="text-sm">{reserva.fecha}</span>
                                    </div>
                                    <div className="flex items-center gap-2 text-slate-300">
                                        <i className="fas fa-clock text-blue-400"></i>
                                        <span className="text-sm">{reserva.hora_inicio} - {reserva.hora_fin}</span>
                                    </div>
                                    <div className="flex items-center gap-2 text-slate-300">
                                        <i className="fas fa-info-circle text-blue-400"></i>
                                        <span className="text-sm">
                                            {reserva.duracion_horas ? `${reserva.duracion_horas}h` : 'N/A'}
                                        </span>
                                    </div>
                                </div>

                                {reserva.motivo_uso && (
                                    <p className="text-sm text-slate-400 mb-4">
                                        <strong className="text-slate-300">Motivo:</strong> {reserva.motivo_uso}
                                    </p>
                                )}

                                <div className="flex flex-wrap gap-2">
                                    {reserva.estado === 'pendiente' && (
                                        <button
                                            onClick={() => onConfirmar(reserva.id)}
                                            className="px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg transition flex items-center gap-2"
                                        >
                                            <i className="fas fa-check-circle"></i>
                                            Confirmar
                                        </button>
                                    )}
                                    {reserva.estado !== 'cancelada' && (
                                        <button
                                            onClick={() => onCancelar(reserva.id)}
                                            className="px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg transition flex items-center gap-2"
                                        >
                                            <i className="fas fa-times-circle"></i>
                                            Cancelar
                                        </button>
                                    )}
                                    <button
                                        onClick={() => onEdit('editarReserva', reserva)}
                                        className="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition flex items-center gap-2"
                                    >
                                        <i className="fas fa-edit"></i>
                                        Editar
                                    </button>
                                    <button
                                        onClick={() => onDelete('reservas', reserva.id)}
                                        className="px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg transition flex items-center gap-2"
                                    >
                                        <i className="fas fa-trash-alt"></i>
                                        Eliminar
                                    </button>
                                </div>
                            </div>
                        ))}
                    </div>
                );
            }

            // Componente Sección Usuarios
            function SeccionUsuarios({ usuarios, onEdit, onDelete }) {
                if (usuarios.length === 0) {
                    return (
                        <div className="text-center py-12 text-slate-400">
                            <i className="fas fa-users w-16 h-16 mx-auto mb-4 opacity-50"></i>
                            <p>No hay usuarios para mostrar</p>
                        </div>
                    );
                }

                return (
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        {usuarios.map(usuario => (
                            <div key={usuario.id} className="bg-slate-800 rounded-xl p-6 border border-slate-700 hover:border-blue-500 transition">
                                <h3 className="text-xl font-bold mb-4">{usuario.nombre}</h3>
                                
                                <div className="space-y-2 mb-4 text-sm">
                                    <p className="text-slate-300">
                                        <strong className="text-slate-400">Email:</strong> {usuario.email}
                                    </p>
                                    <p className="text-slate-300">
                                        <strong className="text-slate-400">Teléfono:</strong> {usuario.telefono}
                                    </p>
                                    <p className="text-slate-300">
                                        <strong className="text-slate-400">Carrera:</strong> {usuario.carrera}
                                    </p>
                                    <p className="text-slate-300">
                                        <strong className="text-slate-400">Total Reservas:</strong> {usuario.total_reservas || 0}
                                    </p>
                                </div>

                                <div className="flex gap-2">
                                    <button
                                        onClick={() => onEdit('editarUsuario', usuario)}
                                        className="flex-1 px-3 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition flex items-center justify-center gap-2"
                                    >
                                        <i className="fas fa-edit"></i>
                                        Editar
                                    </button>
                                    <button
                                        onClick={() => onDelete('usuarios', usuario.id)}
                                        className="px-3 py-2 bg-red-600 hover:bg-red-700 rounded-lg transition"
                                    >
                                        <i className="fas fa-trash-alt"></i>
                                    </button>
                                </div>
                            </div>
                        ))}
                    </div>
                );
            }

            // Componente Modal
            function Modal({ type, item, onClose, onSuccess, onError, salas, usuarios }) {
                const [formData, setFormData] = useState(item || {});
                const [loading, setLoading] = useState(false);

                const handleSubmit = async (e) => {
                    e.preventDefault();
                    setLoading(true);

                    try {
                        let url = '';
                        let method = 'POST';
                        let endpoint = '';

                        // Determinar endpoint y método
                        if (type === 'nuevaSala' || type === 'editarSala') {
                            endpoint = 'salas';
                            if (type === 'editarSala') {
                                url = `${API_URL}/salas/${item.id}/`;
                                method = 'PUT';
                            } else {
                                url = `${API_URL}/salas/`;
                            }
                        } else if (type === 'nuevaReserva' || type === 'editarReserva') {
                            endpoint = 'reservas';
                            if (type === 'editarReserva') {
                                url = `${API_URL}/reservas/${item.id}/`;
                                method = 'PUT';
                            } else {
                                url = `${API_URL}/reservas/`;
                            }
                        } else if (type === 'nuevoUsuario' || type === 'editarUsuario') {
                            endpoint = 'usuarios';
                            if (type === 'editarUsuario') {
                                url = `${API_URL}/usuarios/${item.id}/`;
                                method = 'PUT';
                            } else {
                                url = `${API_URL}/usuarios/`;
                            }
                        }

                        const response = await fetch(url, {
                            method,
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(formData),
                        });

                        if (!response.ok) {
                            const errorData = await response.json();
                            throw new Error(JSON.stringify(errorData));
                        }

                        onSuccess();
                    } catch (err) {
                        onError('Error al guardar: ' + err.message);
                    } finally {
                        setLoading(false);
                    }
                };

                const handleChange = (e) => {
                    const { name, value } = e.target;
                    setFormData(prev => ({ ...prev, [name]: value }));
                };

                return (
                    <div className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4">
                        <div className="bg-slate-800 rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto border border-slate-700">
                            <div className="sticky top-0 bg-slate-800 border-b border-slate-700 px-6 py-4 flex justify-between items-center">
                                <h2 className="text-2xl font-bold">
                                    {type.includes('editar') ? 'Editar' : 'Nuevo'}{' '}
                                    {type.includes('Sala') ? 'Sala' : type.includes('Reserva') ? 'Reserva' : 'Usuario'}
                                </h2>
                                <button onClick={onClose} className="text-slate-400 hover:text-white">
                                    <i className="fas fa-times-circle w-6 h-6"></i>
                                </button>
                            </div>

                            <form onSubmit={handleSubmit} className="p-6 space-y-4">
                                {/* Formulario de Sala */}
                                {(type === 'nuevaSala' || type === 'editarSala') && (
                                    <>
                                        <div>
                                            <label className="block text-sm font-medium mb-2">Nombre *</label>
                                            <input
                                                type="text"
                                                name="nombre"
                                                value={formData.nombre || ''}
                                                onChange={handleChange}
                                                required
                                                className="w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg focus:outline-none focus:border-blue-500"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-2">Capacidad *</label>
                                            <input
                                                type="number"
                                                name="capacidad"
                                                value={formData.capacidad || ''}
                                                onChange={handleChange}
                                                required
                                                min="1"
                                                max="100"
                                                className="w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg focus:outline-none focus:border-blue-500"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-2">Ubicación *</label>
                                            <input
                                                type="text"
                                                name="ubicacion"
                                                value={formData.ubicacion || ''}
                                                onChange={handleChange}
                                                required
                                                className="w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg focus:outline-none focus:border-blue-500"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-2">Equipamiento *</label>
                                            <textarea
                                                name="equipamiento"
                                                value={formData.equipamiento || ''}
                                                onChange={handleChange}
                                                required
                                                rows="3"
                                                className="w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg focus:outline-none focus:border-blue-500"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-2">Estado *</label>
                                            <select
                                                name="estado"
                                                value={formData.estado || 'disponible'}
                                                onChange={handleChange}
                                                required
                                                className="w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg focus:outline-none focus:border-blue-500"
                                            >
                                                <option value="disponible">Disponible</option>
                                                <option value="mantenimiento">Mantenimiento</option>
                                            </select>
                                        </div>
                                    </>
                                )}

                                {/* Formulario de Reserva */}
                                {(type === 'nuevaReserva' || type === 'editarReserva') && (
                                    <>
                                        <div>
                                            <label className="block text-sm font-medium mb-2">Usuario *</label>
                                            <select
                                                name="usuario"
                                                value={formData.usuario || ''}
                                                onChange={handleChange}
                                                required
                                                className="w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg focus:outline-none focus:border-blue-500"
                                            >
                                                <option value="">Seleccionar usuario</option>
                                                {usuarios.map(u => (
                                                    <option key={u.id} value={u.id}>{u.nombre}</option>
                                                ))}
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-2">Sala *</label>
                                            <select
                                                name="sala"
                                                value={formData.sala || ''}
                                                onChange={handleChange}
                                                required
                                                className="w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg focus:outline-none focus:border-blue-500"
                                            >
                                                <option value="">Seleccionar sala</option>
                                                {salas.filter(s => s.estado === 'disponible').map(s => (
                                                    <option key={s.id} value={s.id}>{s.nombre} - Cap: {s.capacidad}</option>
                                                ))}
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-2">Fecha *</label>
                                            <input
                                                type="date"
                                                name="fecha"
                                                value={formData.fecha || ''}
                                                onChange={handleChange}
                                                required
                                                min={new Date().toISOString().split('T')[0]}
                                                className="w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg focus:outline-none focus:border-blue-500"
                                            />
                                        </div>
                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-sm font-medium mb-2">Hora Inicio *</label>
                                                <input
                                                    type="time"
                                                    name="hora_inicio"
                                                    value={formData.hora_inicio || ''}
                                                    onChange={handleChange}
                                                    required
                                                    min="08:00"
                                                    max="22:00"
                                                    className="w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg focus:outline-none focus:border-blue-500"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium mb-2">Hora Fin *</label>
                                                <input
                                                    type="time"
                                                    name="hora_fin"
                                                    value={formData.hora_fin || ''}
                                                    onChange={handleChange}
                                                    required
                                                    min="08:00"
                                                    max="22:00"
                                                    className="w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg focus:outline-none focus:border-blue-500"
                                                />
                                            </div>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-2">Motivo de Uso *</label>
                                            <textarea
                                                name="motivo_uso"
                                                value={formData.motivo_uso || ''}
                                                onChange={handleChange}
                                                required
                                                rows="3"
                                                placeholder="Describe el motivo de la reserva..."
                                                className="w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg focus:outline-none focus:border-blue-500"
                                            />
                                        </div>
                                        {type === 'editarReserva' && (
                                            <div>
                                                <label className="block text-sm font-medium mb-2">Estado *</label>
                                                <select
                                                    name="estado"
                                                    value={formData.estado || 'pendiente'}
                                                    onChange={handleChange}
                                                    required
                                                    className="w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg focus:outline-none focus:border-blue-500"
                                                >
                                                    <option value="pendiente">Pendiente</option>
                                                    <option value="confirmada">Confirmada</option>
                                                    <option value="cancelada">Cancelada</option>
                                                </select>
                                            </div>
                                        )}
                                    </>
                                )}

                                {/* Formulario de Usuario */}
                                {(type === 'nuevoUsuario' || type === 'editarUsuario') && (
                                    <>
                                        <div>
                                            <label className="block text-sm font-medium mb-2">Nombre *</label>
                                            <input
                                                type="text"
                                                name="nombre"
                                                value={formData.nombre || ''}
                                                onChange={handleChange}
                                                required
                                                className="w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg focus:outline-none focus:border-blue-500"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-2">Email *</label>
                                            <input
                                                type="email"
                                                name="email"
                                                value={formData.email || ''}
                                                onChange={handleChange}
                                                required
                                                className="w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg focus:outline-none focus:border-blue-500"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-2">Teléfono *</label>
                                            <input
                                                type="tel"
                                                name="telefono"
                                                value={formData.telefono || ''}
                                                onChange={handleChange}
                                                required
                                                placeholder="+56912345678"
                                                className="w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg focus:outline-none focus:border-blue-500"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-2">Carrera *</label>
                                            <input
                                                type="text"
                                                name="carrera"
                                                value={formData.carrera || ''}
                                                onChange={handleChange}
                                                required
                                                className="w-full px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg focus:outline-none focus:border-blue-500"
                                            />
                                        </div>
                                    </>
                                )}

                                <div className="flex gap-3 pt-4 border-t border-slate-700">
                                    <button
                                        type="submit"
                                        disabled={loading}
                                        className="flex-1 px-4 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg transition font-medium disabled:opacity-50 disabled:cursor-not-allowed"
                                    >
                                        {loading ? 'Guardando...' : 'Guardar'}
                                    </button>
                                    <button
                                        type="button"
                                        onClick={onClose}
                                        className="px-4 py-3 bg-slate-700 hover:bg-slate-600 rounded-lg transition"
                                    >
                                        Cancelar
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white">
                    {/* Header */}
                    <header className="bg-gradient-to-r from-blue-600 to-purple-600 shadow-lg">
                        <div className="max-w-7xl mx-auto px-4 py-6">
                            <div className="flex items-center justify-between">
                                <div>
                                    <h1 className="text-3xl font-bold flex items-center gap-3">
                                        <i className="fas fa-calendar-alt w-8 h-8"></i>
                                        Sistema de Reservas de Salas
                                    </h1>
                                    <p className="text-blue-100 mt-1">Gestión profesional de espacios de estudio</p>
                                </div>
                                <div className="flex items-center gap-3">
                                    <LogoutButton />
                                    <a href="/" className="px-4 py-2 bg-white/20 hover:bg-white/30 rounded-lg transition">
                                        Volver al Inicio
                                    </a>
                                </div>
                            </div>
                        </div>
                    </header>

                    {/* Mensajes de alerta */}
                    {error && (
                        <div className="max-w-7xl mx-auto px-4 mt-4">
                            <div className="bg-red-500/10 border border-red-500 text-red-200 px-4 py-3 rounded-lg flex items-center gap-2">
                                <i className="fas fa-times-circle w-5 h-5"></i>
                                {error}
                            </div>
                        </div>
                    )}

                    {success && (
                        <div className="max-w-7xl mx-auto px-4 mt-4">
                            <div className="bg-green-500/10 border border-green-500 text-green-200 px-4 py-3 rounded-lg flex items-center gap-2">
                                <i className="fas fa-check-circle w-5 h-5"></i>
                                {success}
                            </div>
                        </div>
                    )}

                    {/* Tabs */}
                    <div className="max-w-7xl mx-auto px-4 mt-6">
                        <div className="flex gap-2 border-b border-slate-700">
                            {['salas', 'reservas', 'usuarios'].map(tab => (
                                <button
                                    key={tab}
                                    onClick={() => {
                                        setActiveTab(tab);
                                        setSearchTerm('');
                                        setFilterEstado('todos');
                                    }}
                                    className={`px-6 py-3 font-medium transition capitalize ${
                                        activeTab === tab
                                            ? 'text-blue-400 border-b-2 border-blue-400'
                                            : 'text-slate-400 hover:text-white'
                                    }`}
                                >
                                    {tab}
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Contenido principal */}
                    <div className="max-w-7xl mx-auto px-4 py-6">
                        {/* Barra de acciones */}
                        <div className="flex flex-wrap gap-3 mb-6">
                            <button
                                onClick={() => abrirModal(activeTab === 'salas' ? 'nuevaSala' : 
                                                        activeTab === 'reservas' ? 'nuevaReserva' : 'nuevoUsuario')}
                                className="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition flex items-center gap-2"
                            >
                                <i className="fas fa-plus w-5 h-5"></i>
                                Nuevo
                            </button>
                            
                            <button
                                onClick={cargarDatos}
                                disabled={loading}
                                className="px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg transition flex items-center gap-2"
                            >
                                <i className={`fas fa-sync-alt w-5 h-5 ${loading ? 'animate-spin' : ''}`}></i>
                                Actualizar
                            </button>

                            <div className="flex-1 flex gap-3">
                                <div className="relative flex-1 max-w-md">
                                    <i className="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"></i>
                                    <input
                                        type="text"
                                        placeholder="Buscar..."
                                        value={searchTerm}
                                        onChange={(e) => setSearchTerm(e.target.value)}
                                        className="w-full pl-10 pr-4 py-2 bg-slate-800 border border-slate-700 rounded-lg focus:outline-none focus:border-blue-500"
                                    />
                                </div>

                                {(activeTab === 'salas' || activeTab === 'reservas') && (
                                    <select
                                        value={filterEstado}
                                        onChange={(e) => setFilterEstado(e.target.value)}
                                        className="px-4 py-2 bg-slate-800 border border-slate-700 rounded-lg focus:outline-none focus:border-blue-500"
                                    >
                                        <option value="todos">Todos los estados</option>
                                        {activeTab === 'salas' ? (
                                            <>
                                                <option value="disponible">Disponible</option>
                                                <option value="mantenimiento">Mantenimiento</option>
                                            </>
                                        ) : (
                                            <>
                                                <option value="pendiente">Pendiente</option>
                                                <option value="confirmada">Confirmada</option>
                                                <option value="cancelada">Cancelada</option>
                                            </>
                                        )}
                                    </select>
                                )}
                            </div>
                        </div>

                        {/* Contenido según tab activa */}
                        {loading ? (
                            <div className="text-center py-12">
                                <div className="inline-block w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
                                <p className="mt-4 text-slate-400">Cargando datos...</p>
                            </div>
                        ) : (
                            <>
                                {activeTab === 'salas' && <SeccionSalas salas={datosFiltrados()} onEdit={abrirModal} onDelete={eliminarItem} />}
                                {activeTab === 'reservas' && <SeccionReservas reservas={datosFiltrados()} onEdit={abrirModal} onDelete={eliminarItem} onConfirmar={confirmarReserva} onCancelar={cancelarReserva} />}
                                {activeTab === 'usuarios' && <SeccionUsuarios usuarios={datosFiltrados()} onEdit={abrirModal} onDelete={eliminarItem} />}
                            </>
                        )}
                    </div>

                    {/* Modal */}
                    {modalOpen && (
                        <Modal
                            type={modalType}
                            item={selectedItem}
                            onClose={cerrarModal}
                            onSuccess={() => {
                                cerrarModal();
                                setSuccess('Operación realizada exitosamente');
                                cargarDatos();
                            }}
                            onError={(msg) => setError(msg)}
                            salas={salas}
                            usuarios={usuarios}
                        />
                    )}
                </div>
            );
        }

        ReactDOM.render(<SistemaReservas />, document.getElementById('root'));
    </script>
    {% endverbatim %}
</body>
</html>