<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Reservas - Cliente</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/cliente.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div id="root"></div>

    <!-- Cargar React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- USAR VERBATIM PARA EVITAR QUE DJANGO INTERPRETE EL JS -->
    {% verbatim %}
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        const API_URL = '/api';

        function App() {
            const [activeTab, setActiveTab] = useState('salas');
            const [salas, setSalas] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);

            useEffect(() => {
                cargarSalas();
            }, []);

            const cargarSalas = async () => {
                try {
                    setLoading(true);
                    const response = await fetch(`${API_URL}/salas/`);
                    if (!response.ok) throw new Error(`Error HTTP: ${response.status}`);
                    
                    const data = await response.json();
                    setSalas(data.results || data);
                    setError(null);
                } catch (err) {
                    setError('No se pudieron cargar las salas. ' + err.message);
                    console.error('Error:', err);
                } finally {
                    setLoading(false);
                }
            };

            const handleReservar = (salaId) => {
                alert(`Funcionalidad de reserva para sala ID: ${salaId}`);
            };

            return (
                <div className="app-container">
                    <header className="app-header">
                        <h1><i className="fas fa-calendar-alt"></i> Sistema de Reservas</h1>
                        <p className="subtitle">Gestión profesional de salas de estudio</p>
                    </header>

                    <div className="tabs-container">
                        <div className="tabs">
                            <button 
                                className={`tab ${activeTab === 'salas' ? 'active' : ''}`}
                                onClick={() => setActiveTab('salas')}
                            >
                                <i className="fas fa-door-open"></i> Salas
                            </button>
                            <button 
                                className={`tab ${activeTab === 'reservas' ? 'active' : ''}`}
                                onClick={() => setActiveTab('reservas')}
                            >
                                <i className="fas fa-calendar-check"></i> Reservas
                            </button>
                        </div>
                    </div>

                    <main className="main-content">
                        <div className="header-actions">
                            <button className="btn btn-primary" onClick={() => alert('Nueva reserva - Funcionalidad pendiente')}>
                                <i className="fas fa-plus"></i> Nueva Reserva
                            </button>
                            <button className="btn btn-secondary" onClick={cargarSalas}>
                                <i className="fas fa-sync-alt"></i> Actualizar
                            </button>
                        </div>

                        {loading ? (
                            <div className="loading-container">
                                <div className="loading-spinner"></div>
                                <p>Cargando salas...</p>
                            </div>
                        ) : error ? (
                            <div className="alert alert-error">
                                <i className="fas fa-exclamation-circle"></i> {error}
                            </div>
                        ) : activeTab === 'salas' ? (
                            salas.length === 0 ? (
                                <div className="empty-state">
                                    <i className="fas fa-door-closed"></i>
                                    <h3>No hay salas disponibles</h3>
                                    <p>Ejecuta: <code>python manage.py crear_datos</code> para generar datos de prueba</p>
                                </div>
                            ) : (
                                <>
                                    <h2 className="section-title">
                                        <i className="fas fa-door-open"></i> Salas Disponibles ({salas.filter(s => s.estado === 'disponible').length})
                                    </h2>
                                    <div className="salas-grid">
                                        {salas.map(sala => (
                                            <div key={sala.id} className="sala-card">
                                                <h3>
                                                    {sala.nombre}
                                                    <span className={`badge ${sala.estado}`}>
                                                        <i className="fas fa-circle"></i> {sala.estado}
                                                    </span>
                                                </h3>
                                                <div className="sala-info">
                                                    <div className="info-item">
                                                        <i className="fas fa-map-marker-alt"></i>
                                                        <span><strong>Ubicación:</strong> {sala.ubicacion}</span>
                                                    </div>
                                                    <div className="info-item">
                                                        <i className="fas fa-users"></i>
                                                        <span><strong>Capacidad:</strong> {sala.capacidad} personas</span>
                                                    </div>
                                                    <div className="info-item">
                                                        <i className="fas fa-tools"></i>
                                                        <span><strong>Equipamiento:</strong> {sala.equipamiento}</span>
                                                    </div>
                                                </div>
                                                <button 
                                                    className="btn btn-primary w-100" 
                                                    onClick={() => handleReservar(sala.id)}
                                                    style={{marginTop: '1rem'}}
                                                >
                                                    <i className="fas fa-bookmark"></i> Reservar esta sala
                                                </button>
                                            </div>
                                        ))}
                                    </div>
                                </>
                            )
                        ) : (
                            <div className="empty-state">
                                <i className="fas fa-calendar-times"></i>
                                <h3>No hay reservas</h3>
                                <p>Haz clic en "Nueva Reserva" para comenzar</p>
                            </div>
                        )}
                    </main>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
    {% endverbatim %}
</body>
</html>